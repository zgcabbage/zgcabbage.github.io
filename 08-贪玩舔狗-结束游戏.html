<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>è´ªç©èˆ”ç‹—ğŸ¶</title>
  <link rel="stylesheet" href="./style.css">
</head>
<body>

  <img class="wsc" src="./img/wsc.jpg" alt="ç‹æ€èª">
  
  <div class="play-panel">
    <div class="start"><span class="btn">â¥å¼€å§‹æ¸¸æˆ</span></div>
    <div class="stop">
      <div class="title">æ¸¸æˆç»“æŸ</div>
      <div class="score">60åˆ†</div>
      <div class="btn">â€»é‡æ–°å¼€å§‹â€»</div>
    </div>
  </div>
  
  <div class="game-score">
    <h1>å‰©ä½™æ—¶é—´<span>60</span>ç§’</h1>
    <h1>+10åˆ†</h1>
  </div>

  <script>
  function random(min, max) {
    return Math.floor( Math.random() * (max-min+1)+min ) 
  }

  // ### å…¨å±€å˜é‡
  let wscObj =  document.querySelector('.wsc')
  let score = 0
  let wscX = 0
  let wscY = (window.innerHeight||document.documentElement.clientHeight) - wscObj.offsetHeight
  

  // ###éšæœºé£Ÿç‰© xè½´
  // 1 æ‰“å¼€é¡µé¢ï¼Œæ‰§è¡Œå®šæ—¶å™¨ä»£ç  1s
  // 2 å®šæ—¶å™¨å¤„ç†å‡½æ•°ä¸­ 
  //   2.1 éšæœºæ•°0-9  
  //   2.2 åˆ¤æ–­2.1éšæœºæ•°68åˆ›å»ºå† å†›é£Ÿç‰©ï¼Œ01234579çƒ­ç‹—é£Ÿç‰©
  //   2.3 è¿½åŠ é£Ÿç‰©åˆ°é¡µé¢

  let foodT = setInterval(() => {
    // åˆå§‹åŒ–æ•°æ®
    let imgObj = document.createElement('img')

    // é£Ÿç‰©å‡ºç°æ¦‚ç‡
    let who = random(0,9) // 68-å† å†›,01234579-çƒ­ç‹—
    
    // åˆ¤æ–­å‡ºç°é£Ÿç‰©
    if ([6,8].includes(who))
    {
      // <img class="guanjun" src="./img/guanjun.jpg" />
      imgObj.className = 'food guanjun'
      imgObj.src = './img/guanjun.jpg'
      imgObj.setAttribute('type', 'guanjun')
    } else {
      // <img class="hotdog" src="./img/hotdog.jpg" />
      imgObj.className = 'food hotdog'
      imgObj.src = './img/hotdog.jpg'
      imgObj.setAttribute('type', 'hotdog')
   }

    // è¿½åŠ é£Ÿç‰©åˆ°é¡µé¢
    let min = 0
    let max = (window.innerWidth || document.documentElement.clientWidth) - imgObj.offsetWidth
    imgObj.style.left = random(min, max) + 'px'
    imgObj.style.top = '0px'
    document.body.appendChild(imgObj)
  }, 1000)


  // ### é£Ÿç‰©æ‰è½ yè½´
  // 1 æ‰“å¼€é¡µé¢ï¼Œæ‰§è¡Œå®šæ—¶å™¨ä»£ç  50ms
  // 2 å®šæ—¶å™¨å¤„ç†å‡½æ•°ä¸­ 
  //   2.1 è·å–æ‰€æœ‰é£Ÿç‰©
  //   2.2 éå†
  //   2.3 è®¡ç®—topæ•°æ®ï¼šåŸtop+ 2
  //   2.4 åˆ¤æ–­ä½ç½®  è¶…å‡º-ç½‘é¡µç§»é™¤ï¼Œæ²¡è¶…å‡º-é‡ç½®top

  setInterval(() => {
    // è·å–æ‰€æœ‰é£Ÿç‰©
    let foods = document.querySelectorAll('.food')
    // éå†
    foods.forEach((item, index) => { // itemå°±æ˜¯ä¸€ä¸ªä¸ªå›¾ç‰‡é£Ÿç‰©
      // è®¡ç®—topæ•°æ®ï¼šåŸtop+ 2
      let top = parseInt(item.style.top) + 2
      // åˆ¤æ–­ä½ç½®  è¶…å‡º-ç½‘é¡µç§»é™¤ï¼Œæ²¡è¶…å‡º-é‡ç½®top
      let maxTop = (window.height || document.documentElement.clientHeight) - item.offsetHeight
      if (top >= maxTop) {
        document.body.removeChild(item)
      } else {
        item.style.top = top + 'px'
      }

      // 3. é£Ÿç‰©æ‰è½åˆ¤æ–­æ˜¯å¦åœ¨ç‹å…¬å­èŒƒå›´å†…
      //    å…¬å¼xï¼š  é£Ÿç‰©x > ç‹å…¬å­x  && é£Ÿç‰©x < ç‹å…¬å­x+è‡ªèº«å®½åº¦
      //    å…¬å¼yï¼š  é£Ÿç‰©y+è‡ªèº«é«˜åº¦ > ç‹å…¬å­y
      //    ç¬¦ åˆï¼šã€å…¬å¼xã€å…¬å¼yã€‘åˆ™åˆ†æ•°+1
      let foodX = parseInt(item.style.left)
      let foodY = parseInt(item.style.top) + item.offsetHeight
      if ( 
        (foodX>wscX && foodX<=(wscX+wscObj.offsetWidth))
        &&
        foodY>wscY
      ) {
        let type = item.getAttribute('type')
        // score++
        type == 'guanjun' ? score+=5 : score++
        console.log(`é£Ÿç‰©åæ ‡ã€${foodX},${foodY}ã€‘ï¼Œç‹å…¬å­åæ ‡ã€${wscX+wscObj.offsetWidth},${wscY+wscObj.offsetHeight}ã€‘ï¼Œ+1ï¼Œæ€»åˆ†ã€${score}}ã€‘`);
        document.querySelector('.game-score h1:nth-of-type(2)').innerText = `+${score}åˆ†`
        document.body.removeChild(item) 
        
        // æç¤º <div class="show-score">+1</div>
        let divObj = document.createElement('div')
        divObj.className = 'show-score'
        divObj.innerText = type == 'guanjun' ? '+5' : '+1' 
        divObj.style.left = wscX+wscObj.offsetWidth + 'px'
        // divObj.style.bottom = wscY+wscObj.offsetHeight + 'px'
        document.body.appendChild(divObj)
        setTimeout(() => document.body.removeChild(divObj), 1000)
      }
      
    })
  })

  
  // ### å®‰æ’ç‹å…¬å­
  // 1 æ‰“å¼€ç½‘é¡µï¼Œç»‘å®šé¼ æ ‡ç§»åŠ¨äº‹ä»¶
  // 2 äº‹ä»¶å¤„ç†å‡½æ•°ä¸­
  //   2.1 è·å–äº‹ä»¶å¯¹è±¡
  //   2.2 é™å®šleftæœ€å¤§0 æœ€å¤§ç½‘é¡µå®½åº¦-ç‹å…¬å­å®½åº¦
  //   2.3 åŒæ­¥leftä¸ºé¼ æ ‡ä½ç½®
  
  document.onmousemove = function(evt) {
    // è·å–äº‹ä»¶å¯¹è±¡
    let e = evt || window.event
    // é™å®šleftæœ€å¤§0 æœ€å¤§ç½‘é¡µå®½åº¦-ç‹å…¬å­å®½åº¦
    let wscObj = document.querySelector('.wsc')
    let left = e.clientX - wscObj.offsetWidth/2
    let maxLeft = (window.innerWidth || document.documentElement.clientWidth) - wscObj.offsetWidth
    if (left<0) left = 0
    if (left>=maxLeft) left = maxLeft
    // åŒæ­¥leftä¸ºé¼ æ ‡ä½ç½®
    wscObj.style.left = left + 'px'

    // é‡ç½®ç‹å…¬å­åæ ‡
    wscX = left
  }


  // ### åƒé£Ÿç‰©
  // 1. scriptå¼€å§‹æ ‡è®°ä½ç½®å®šæ—¶å…¨å±€å˜é‡ ä¿å­˜ç‹å…¬å­åæ ‡
  // 2. ç‹å…¬å­ç§»åŠ¨ é‡ç½®å…¨å±€å˜é‡
  // 3. é£Ÿç‰©æ‰è½åˆ¤æ–­æ˜¯å¦åœ¨ç‹å…¬å­èŒƒå›´å†…
  //    å…¬å¼xï¼š  é£Ÿç‰©x > ç‹å…¬å­x  && é£Ÿç‰©x <= ç‹å…¬å­x+è‡ªèº«å®½åº¦
  //    å…¬å¼yï¼š  é£Ÿç‰©y+è‡ªèº«é«˜åº¦ > ç‹å…¬å­y  
  //    ç¬¦ åˆï¼šã€å…¬å¼xã€å…¬å¼yã€‘åˆ™åˆ†æ•°+1


  // ### ç»“æŸæ¸¸æˆ
  // 1 æ‰“å¼€é¡µé¢ï¼Œæ‰§è¡Œå®šæ—¶å™¨ä»£ç  1s
  // 2 å®šæ—¶å™¨å¤„ç†å‡½æ•°ä¸­ 
  //   2.1 time--
  //   2.2 åˆ¤æ–­
  //   time>=0 åŒæ­¥åˆ°é¡µé¢
  //   else   1-æ¸…é™¤æ¸¸æˆå€’è®¡æ—¶ã€2-æ¸…é™¤éšæœºé£Ÿç‰©ã€3-é‡ç½®æ¸¸æˆ60sã€4-å±•ç¤ºé‡æ–°å¼€å§‹é¢æ¿

  let time = 60
  let gameT = setInterval(() => {
    time--
    let gameScoreObj = document.querySelector('.game-score span')
    if (time>=0) {
      gameScoreObj.innerText = time
    }else {
      
      clearInterval(gameT) // 1-æ¸…é™¤æ¸¸æˆå€’è®¡æ—¶
      clearInterval(foodT) // 2-æ¸…é™¤éšæœºé£Ÿç‰©
      time = 60            // 3-é‡ç½®æ¸¸æˆ60s
      // 4-å±•ç¤ºé‡æ–°å¼€å§‹é¢æ¿
      let payPanel = document.querySelector('.play-panel')
      let payPanelStop = payPanel.querySelector('.stop')
      payPanel.querySelector('.score').innerText = score+'åˆ†'
      payPanel.style.display =  payPanelStop.style.display = 'block'
    }
  }, 1000)
  </script>
</body>
</html>